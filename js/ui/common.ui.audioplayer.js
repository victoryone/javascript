!function(a,b,c){"use strict";if(!a)throw new Error("jQuery라이브러리를 포함시켜 주세요.");if(!b)throw new Error("emart라이브러리를 포함시켜 주세요.");if(!mejs)throw new Error("MediaElement 라이브러리를 포함시켜 주세요.");var d=0,e=function(){return d++},f=b.isTouch,g=b.Base.extend({$mixins:[b.Listener],$statics:{ON_ADDED:"added",ON_REMOVED:"removed"},defaults:{isShuffle:!1,idAttribute:"id",srcAttribute:"src"},initialize:function(b){var c=this;c.options=a.extend(!0,{},c.defaults,b),c.currentIndex=-1,c.list=[]},add:function(a){var c=this;return b.array.include(c.list,function(b){return b.id+""==a.id+""?!0:void 0})||(c.currentIndex<0&&(c.currentIndex=0),c.list.push(a),c.trigger("added",a)),!1},remove:function(a){var c=this;a=b.isArray(a)?a:[].concat(a),b.each(a,function(a){b.array.remove(c.list,function(b){return b.id+""==a+""},function(b){c.size()>0?(b<c.currentIndex&&(c.currentIndex-=1),c.currentIndex=Math.min(c.size()-1,c.currentIndex)):c.currentIndex=-1,c.trigger("removed",{id:a})})}),c.currentIndex=0|Math.min(c.currentIndex,c.list.length-1)},current:function(a){return a&&this._setCurrentIndexById(a),this.at(this.list.length>0?Math.max(0,this.currentIndex):-1)},_setCurrentIndexById:function(a){for(var b=0;b<this.list.length;b++)if(this.list[b].id+""==a+""){this.currentIndex=0|b;break}},indexOf:function(a){for(var b=0;b<this.list.length;b++)if(this.list[b].id+""==a+"")return b;return-1},first:function(){return this.list[0]},last:function(){return this.list[this.list.length-1]},has:function(a){var c=this;return b.array.include(c.list,function(b){return b.id+""==a+""?!0:void 0})},isFirst:function(){return 0===this.currentIndex},isLast:function(){return this.currentIndex===this.list.length-1},at:function(a){return 0>a||a>=this.list.length?null:this.list[a]},get:function(a){return this.find("id",a)},each:function(a){return b.each(this.tracks,a)},next:function(){var a=0;return a=this.options.isShuffle?Math.floor(Math.random()*this.list.length):this.currentIndex+1>=this.list.length?0:this.currentIndex+1,this.setCurrentIndex(0|a),this.current()},prev:function(){var a=0;return a=this.options.isShuffle?Math.floor(Math.random()*this.list.length):this.currentIndex-1<0?this.list.length-1:this.currentIndex-1,this.setCurrentIndex(0|a),this.current()},find:function(a,b){for(var c,d=-1;c=this.list[++d];)if(c[a]+""==b+"")return c;return null},reset:function(a){this.list=a},sort:function(a){var c=[];b.each(a,function(a){c.push(this.get(a))}.bind(this)),this.list=c,this.setCurrentIndex(Math.min(this.currentIndex,this.list.length-1))},setCurrentIndex:function(a){this.currentIndex=Math.max(0,Math.min(a,this.list.length-1))},size:function(){return this.list.length},getAll:function(){return this.list},insert:function(a,b){this.list.splice(a,0,b),this.triggerHandler("added",b)},move:function(a,b){this.list.splice(b,0,this.list.splice(a,1)[0]),this.currentIndex=b}}),h=c.View.extend({name:"SlideBar",defaults:{interval:100,direction:"horizontal",maxValue:0,minValue:0,distValue:10,titleFormat:"{0}"},selectors:{bar:".d-bar"},initialize:function(a,b){if(this.callParent(a,b)!==!1){var c=this;c.isHoriz="horizontal"===c.options.direction,c.sizeName=c.isHoriz?"width":"height",c.xyName=c.isHoriz?"X":"Y",c.dirName=c.isHoriz?"left":"top",c.$bar.css(c.sizeName,0).css("cursor","pointer").attr("title","0"),c.$el.css("cursor","pointer"),c._initEvents()}},_initEvents:function(){function a(a){return{x:b.isTouch?a.touches[0].clientX:a.clientX,y:b.isTouch?a.touches[0].clientY:a.clientY}}var c,d=this;d.on("mousedown touchstart",function(b){c=a(b)}).on("click",function(b){b.preventDefault();var e=a(b);if(!(d.options.maxValue<=0||d.$el.hasClass("disabled")||c.x!==e.x||c.y!==e.y)){var f=b["page"+d.xyName]-d.$el.offset()[d.dirName],g=d.$el[d.sizeName](),h=(d.isHoriz?f:g-f)/g,i=h*d.options.maxValue;d._setValue(i)}}),d._bindKeyboardEvents(),d._bindDrag()},_bindDrag:function(){var a,b=this,d=b.$bar.children(),e=b.$bar.parent().width(),f=0;a=new c.Dragger(d),a.on("dragstart",function(){0!==b.options.maxValue&&(f=b.$bar.width(),b.$bar.addClass("d-dragging"))}).on("dragmove",function(a,c){if(0!==b.options.maxValue){var d=c.x+f,g=d/e;d>=0&&e>=d&&(b.$bar.css("width",100*g+"%"),b.triggerHandler("valuechange",{value:b.options.maxValue*g}))}}).on("dragend",function(){0!==b.options.maxValue&&(b.$bar.removeClass("d-dragging"),b._setValue(b.$bar.width()/e*b.options.maxValue))})},_bindKeyboardEvents:function(){var a=this;if(!f){a.upKey=a.isHoriz?39:38,a.downKey=a.isHoriz?37:40;var b=0;a.on("keydown",function(c){if(c.keyCode===a.downKey||c.keyCode===a.upKey){if(c.stopPropagation(),c.preventDefault(),a.$el.hasClass("disabled"))return;if(0===b&&(b=+new Date),+new Date-b<200)return;b=+new Date,a._moveBar(c.keyCode===a.downKey?-1:1)}}).on("keyup",function(b){if(b.keyCode===a.downKey||b.keyCode===a.upKey){if(b.stopPropagation(),b.preventDefault(),a.$el.hasClass("disabled"))return;a._moveBar(b.keyCode===a.downKey?-1:1)}})}},_moveBar:function(a){var b=this,c=0;c=0>a?Math.max(0,b.value-b.options.distValue):Math.min(b.options.maxValue,b.value+b.options.distValue),b._setValue(c)},setMaxValue:function(a){var b=this;b.options.maxValue=a,a<b.value&&b.setValue(a)},setTitle:function(a){var b=this;b.$bar[0].title=a},_setValue:function(b){var c=this,d=a.Event("valuechanged");c.triggerHandler(d,{value:b}),d.isDefaultPrevented()||c.setValue(b)},setValue:function(a){var b,c=this;a<c.options.minValue||a>c.options.maxValue||c.$bar.hasClass("d-dragging")||(c.value=a,0===c.options.maxValue?(c.$bar[0].style[c.sizeName]="0%",c.$bar.data("percent",0)):(c.$bar[0].style[c.sizeName]=(b=Math.min(100,a/c.options.maxValue*100))+"%",c.$bar.data("percent",b)),c.setTitle(Math.round(b)))}}),i=c.View.extend({name:"PlayList",selectors:{list:".d-tracklist"},initialize:function(b,c){var d=this;d.callParent(b,c)!==!1&&(d.tracks=new g,d.tracks.on("added",function(a,b){d._add(b)}).on("removed",function(a,b){d._remove(b.id)}),d.$list.on("click","a",function(b){b.preventDefault(),d.triggerHandler("selected",{id:a(this).attr("data-id")})}).on("click",".list_del",function(){var b=a(this).closest("li[data-id]");if(confirm("'"+b.find(".tit").text()+"'을(를) 삭제하시겠습니까?")){var c=b.attr("data-id");d.tracks.remove(c)}}).on("mouseenter mouseleave","li",function(b){a(this).toggleClass("on","mouseenter"===b.type)}),d.on("click",".d-removeall",function(a){a.preventDefault();var b=d.getCheckedList();return b.length<=0?void alert("삭제할 곡을 체크해주세요."):void(confirm("선택한 곡을 삭제하시겠습니까?")&&(d.tracks.remove(b),d.$(".d-checkall").prop("checked",!1)))}).on("click",".d-checkall",function(b){b.stopPropagation(),d.$list.find("input:checkbox").prop("checked",a(this).prop("checked"))}),d.$list.sortable({items:"> li",axis:"y",update:function(a,b){var c=d.$list.find(">li").index(b.item);d.tracks.move(d.tracks.indexOf(b.item.attr("data-id")),c)}}))},getCheckedList:function(){var a=this.$el.find(".d-tracklist input:checkbox:checked").map(function(){return this.value}).get();return a},_remove:function(a){this.removeRow(a),this.triggerHandler("removedtrack",{id:a})},_add:function(a){this.addRow(a),this.triggerHandler("addedtrack",{id:a.id})},addRow:function(a){var b=this;b.$list.append(['<li class="d-track" data-id="'+a.id+'"><input type="checkbox" name="" value="'+a.id+'" id="track-'+a.id+'" title="'+a.title+' 곡 선택하기">','<label for="track-'+a.id+'" class=""><span class="tit"><a href="#" data-id="'+a.id+'">'+a.title+'</a></span> - <span class="pd">'+a.artist+'</span></label><button class="list_del"><span class="none">곡 삭제하기</span></button></li>'].join(""))},removeRow:function(a){var b=this;b.$list.find('>.d-track[data-id="'+a+'"]').empty().remove()},select:function(a){var b,c=this;a===!0&&(b=c.tracks.current())?c.$list.find('>.d-track[data-id="'+b.id+'"]').activeItem("ing"):c.$list.find(">.d-track").removeClass("ing")}}),j=c("EmartAudioPlayer",{bindjQuery:"emartAudioPlayer",defaults:{mediaType:"audio/mp3",idAttribute:"id",srcAttribute:"src",shuffle:!1,loop:"",alwaysShowHours:!1,showTimecodeFrameCount:!1,framesPerSecond:.5,startVolume:.5,features:["playpause","current","progress","duration","tracks","volume","fullscreen"],success:function(){}},selectors:{timeTrack:".d-timetrack",timeBar:".d-timebar",time:".d-time",duration:".d-duration",SlideBar:".d-SlideBar",volumeTrack:".d-volumetrack",volumeBar:".d-volumebar",playlistLayer:".d-playlistlayer",titleBox:".d-title-box"},initialize:function(a,c){var d=this;d.callParent(a,c)!==!1&&(d.$(".d-control").disabled(),d._createPlayList(),d._createMedia(),b.isTouch&&d.$(".d-vol").hide())},_createPlayList:function(){var a=this;a.playList=new i(a.$playlistLayer),a.playList.on("selected",function(b,c){b.preventDefault(),a.playById(c.id)}).on("removedtrack",function(){0===a.playList.tracks.size()?a.initPlayer():(a.enables(!0),a.isPlaying()?a.playList.tracks.current().src!=a.currentSrc&&a.playByTrack(a.playList.tracks.current()):a._initTimeInfo())})},_createMedia:function(){var b=this;if(!b._initedMedia){b._initedMedia=!0;var c="media_"+e(),d=setTimeout(function(){alert("죄송합니다. 현재 사용하시는 브라우저에는 본 오디오기능을 사용하실 수 없습니다.\nHTML5 혹은 플래쉬플러그인을 지원하는 브라우저에서 사용하실 수 있습니다.")},1e4);b.enables(!1),b.$el.append('<audio id="'+c+'" type="audio/mp3" preload="auto" src="javascript:;" style="display:none;" width="0" height="0"></audio>'),new MediaElement(c,a.extend({},b.options,{type:"audio/mp3",pluginWidth:0,pluginHeight:0,plugins:["flash"],pluginPath:"/js/libs/",flashName:"flashmediaelement.swf",silverlightName:"silverlightmediaelement.xap",success:function(c){clearTimeout(d),b.media=c,b.$media=a(c),b._initEvents(),b.options.success.apply(b.$el[0],arguments),b.setVolume(b.options.startVolume),"one"===b.options.loop?b.$(".d-loop").addClass("one"):"all"===b.options.loop&&b.$(".d-loop").addClass("on"),b.triggerHandler("success",{media:c})},error:function(){b.triggerHandler("error")}}))}},_handleMedia:function(){var a=this;a.$media.on("play pause volumechange ended loadeddata canplay seeked seeking error playing loadedmetadata timeupdate ready",function(b){switch(b.type){case"playing":a._togglePlayButton(!0),a._setTrackInfo(a.currentTrack=a.playList.tracks.current()),a._showDuration();break;case"pause":a._togglePlayButton(!1);break;case"ended":a._togglePlayButton(!1),a._checkNextPlay();break;case"timeupdate":a._showTime();break;case"canplay":a.enables();break;case"loadeddata":case"loadedmetadata":a._showDuration();break;case"error":switch(b.target.error.code){case b.target.error.MEDIA_ERR_ABORTED:console.log("You aborted the video playback.");break;case b.target.error.MEDIA_ERR_NETWORK:console.log("A network error caused the audio download to fail.");break;case b.target.error.MEDIA_ERR_DECODE:console.log("The audio playback was aborted due to a corruption problem or because the video used features your browser did not support.");break;case b.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:console.log("The video audio not be loaded, either because the server or network failed or because the format is not supported.");break;default:console.log("An unknown error occurred.")}}"timeupdate"!==b.type&&console.log("type:",b.type)}),a.$media.on("playing",function(){a.playList.select(!0)}).on("ended",function(){a.playList.select(!1)})},_initEvents:function(){var b=this;b._handleMedia(),b.on("click",".d-play",function(a){a.preventDefault();var c=b.playList.tracks.current();c&&(b.currentSrc!=c.src&&(b.setSrc(c.src),b.load()),b.play())}).on("click",".d-pause",function(a){a.preventDefault(),b.pause()}).on("click",".d-stop",function(a){a.preventDefault(),b.stop(),b.triggerHandler("stop",{media:b.media})}).on("click",".d-prev",function(a){a.preventDefault(),b.prev()}).on("click",".d-next",function(a){a.preventDefault(),b.next()}).on("click",".d-volumeup",function(a){a.preventDefault(),b.setVolume(Math.min(1,b.media.volume+.1))}).on("click",".d-volumedown",function(a){a.preventDefault(),b.setVolume(Math.max(0,b.media.volume-.1))}).on("click",".d-loop",function(c){c.preventDefault();var d=a(this);d.hasClass("on")?(d.removeClass("on"),b.options.loop=""):d.hasClass("one")?(d.replaceClass("one","on"),b.options.loop="all"):(d.addClass("one"),b.options.loop="one")}).on("click",".d-mute",function(a){a.preventDefault(),b.setMuted(!b.media.muted)}).on("click",".d-shuffle",function(c){c.preventDefault(),a(this).toggleClass("on",b.options.shuffle=b.playList.tracks.options.isShuffle=!b.playList.tracks.options.isShuffle)}),b._initProgress(),b.playList.on("addedtrack",function(){clearTimeout(b.trackTimer),!b.isPlaying()&&b._setTrackInfo({title:"총 "+b.playList.tracks.size()+"곡이 있습니다."}),b.trackTimer=setTimeout(function(){b.enables()},100)})},_initProgress:function(){var a=this;a.$timeTrack.addClass("d-control"),a.timeCtrl=new h(a.$timeTrack[0],{selectors:{bar:".d-timebar"}}).on("valuechanged",function(b,c){a.setCurrentTime(c.value)});var b;a.timeCtrl.setValue(0),a.$media.on("timeupdate ended",function(c){switch(c.type){case"timeupdate":if(b||(b=+new Date),+new Date-b>1e3){var d=a.currentSrc?a.media.currentTime:0,e=a._generateTime(d);a.timeCtrl.setTitle(e),a.timeCtrl.setValue(d),b=+new Date}break;case"ended":a.timeCtrl.setValue(0),a.$time.html("00:00")}}).on("canplay loadedmetadata playing",function(){a.timeCtrl.setMaxValue(a.currentSrc?a.media.duration:0)}),a.$volumeBar.length>0&&(mejs.MediaFeatures.hasTouch?a.$("[class^=d-vol]").hide():(a.$volumeTrack.addClass("d-control"),a.volumeCtrl=new h(a.$volumeTrack[0],{maxValue:1,distValue:.1,value:a.options.startVolume,selectors:{bar:".d-volumebar"}}).on("valuechange valuechanged",function(b,c){a.setVolume(c.value)}),a.volumeCtrl.setValue(a.options.startVolume)))},_setTrackInfo:function(a){var b=this,a=a||b.playList.tracks.current();if(a){var c="";a.title&&(c=a.title,a.artist&&(c+=" - "+a.artist)),b.$(".d-title").html(c||"재생할 곡이 없습니다. 곡을 선택해주세요."),b.$(".d-artist").html(a.artist||""),b.$(".d-lyricbox").html(a.lyrics?a.lyrics.replace(/\r\n|\n/g,"<br>"):"가사가 없습니다.").parent().animate({scrollTop:0}),b.$(".d-control.down").attr("data-href",a.music_file_down)}},initPlayer:function(){var a=this;a._togglePlayButton(!1),a._setTrackInfo({}),a._initTimeInfo(),a.stop(),a.setSrc(""),a.enables(!1)},_initTimeInfo:function(){var a=this;a.timeCtrl.setValue(0),a.$time.html("00:00"),a.timeCtrl.setMaxValue(0),a.$duration.html("00:00")},_checkNextPlay:function(){var a=this;return"one"===a.options.loop?void a.play(0):void(a.playList.tracks.isLast()&&"all"!==a.options.loop||a.next())},_togglePlayButton:function(a){var b=this;a?b.$(".d-play").replaceClass("d-play play","d-pause pause").attr("title","정지").html("정지"):b.$(".d-pause").replaceClass("d-pause pause","d-play play").attr("title","재생").html("재생")},_generateTime:function(a){var b=this;return a|!1?mejs.Utility.secondsToTimeCode(a,!1,!1,b.options.framesPerSecond||25):"00:00"},_showTime:function(){var a=this;a.$time.html(a._generateTime(a.currentSrc?a.media.currentTime:0))},_showDuration:function(){var a=this;a.$duration.html(a._generateTime(a.currentSrc?a.media.duration:0))},getTracks:function(){return this.playList.tracks},getMedia:function(){return this.media},enables:function(a){var b=this;a===!1&&b.media&&!b.media.paused&&(b.setCurrentTime(0),b.pause()),b.$(".d-control").disabled(a===!1)},hasTrack:function(a){return this.playList.tracks.has(a)},isPlaying:function(){return!this.media.paused},playById:function(a){var b=this.playList.tracks.current(a);this.playByTrack(b)},playByTrack:function(a){return a?(this.pause(),this.setSrc(a.src),this.load(),void this.play(0)):void this.triggerHandler("error","[playById()] 선택하신 트랙이 리스트에 존재하지 않습니다.")},sort:function(a){this.playList.tracks.sort(a)},remove:function(a){var c=this;b.isArray(a)||(a=[].concat(a)),c.playList.tracks.remove(a)},setSrc:function(a){var c=this;"native"!==c.media.pluginType||"oncanplay"in document.createElement("audio")||c.$media.on("progress.canplay",function(){c.$media.triggerHandler("canplay"),c.$media.off("progress.canplay")}),c.currentSrc=a,a?a=b.uri.addParam(a,{_:+new Date}):c.pause(),c.media.setSrc(a)},load:function(){this.media.load()},play:function(a){console.log("play",a),this.media.play(a)},pause:function(){console.log("pause"),this.media.pause()},stop:function(){console.log("stop");try{this.setCurrentTime(0)}catch(a){}this.media.pause()},setVolume:function(a){try{this.media.setVolume(a)}catch(b){}},setMuted:function(a){this.media.setMuted(a)},setCurrentTime:function(a){this.media.setCurrentTime(a)},_add:function(b){a.trim(b[this.options.idAttribute])&&a.trim(b[this.options.srcAttribute])&&(b.id||(b.id=b[this.options.idAttribute]),b.src||(b.src=b[this.options.srcAttribute]),this.playList.tracks.add(b))},addTracks:function(a){var c=this;a=b.isArray(a)?a:[].concat(a),b.each(a,function(a){c._add(a)})},next:function(){var a=this,b=a.playList.tracks.next();a.pause(),a.setSrc(b.src),a.load(),a.play(0)},prev:function(){var a=this,b=a.playList.tracks.prev();a.pause(),a.setSrc(b.src),a.load(),a.play(0)},shuffle:function(){this.playList.tracks.shuffle()}});window.EmartAudioPlayer=j}(jQuery,window[LIB_NAME],window[LIB_NAME].ui);